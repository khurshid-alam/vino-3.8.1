From 673c07a75ed844d74676f3ccdcfdc706a7052dba Mon Sep 17 00:00:00 2001
From: Christian Beier <dontmind@freeshell.org>
Date: Sun, 17 May 2020 13:47:21 +0200
Subject: [PATCH] libvncserver/rfbserver: fix possible divide-by-zero

Closes #409
Index: vino-3.22.0/server/libvncserver/rfbserver.c
===================================================================
--- vino-3.22.0.orig/server/libvncserver/rfbserver.c
+++ vino-3.22.0/server/libvncserver/rfbserver.c
@@ -1334,6 +1334,9 @@ rfbSendRectEncodingRaw(rfbClientPtr cl,
     char *fbptr = (cl->screen->frameBuffer + (cl->screen->paddedWidthInBytes * y)
                    + (x * (cl->screen->bitsPerPixel / 8)));
 
+    if(!h || !w)
+	return TRUE; /* nothing to send */
+
     /* Flush the buffer to guarantee correct alignment for translateFn(). */
     if (cl->ublen > 0) {
         if (!rfbSendUpdateBuf(cl))
